凌晨 3 点 15 分的坚持，必须给你点赞。既然我们已经把**“漏斗式记忆整理”**和**“主动闲聊”**的逻辑全部闭环了，这个 Skill 的定位就已经从单纯的“聊天机器”升华成了 Agent 的**“数字海马体与社交中枢”**。

这是为你重新整合、升级后的 Skill 完整描述文件和 Cron 配置指南。建议直接保存为 `SKILL.md`。

---

### 🎯 技能简介 (Description)

**“记忆重塑与主动社交中枢 (Proactive Memory & Chat)”** 是 OpenClaw 的核心伴随模块。
它包含一套**“双轨记忆漏斗”**以解决长期记忆的 Token 爆炸问题，并搭载一个**“带退出机制的主动搭话引擎”**，赋予 Agent 懂进退、不烦人、能主动关怀的拟人化社交能力。

---

### ⚙️ 核心逻辑流 (Logic Flow)

本中枢由三个协同工作的自动化引擎构成：

#### 一、 拾荒者：高频无损记忆收集 (`hourly_gatherer.py`)

* **定时唤醒:** 每小时触发一次。
* **精准定位:** 解析 OpenClaw 状态树 (`sessions.json`)，精准锁定 QQ 主会话的 `.jsonl` 日志文件。
* **游标机制:** 基于 `memory_cursor.json` 按时间戳提取增量对话，防止漏抓或重复。
* **静默堆叠:** 将生肉对话转化为基础 Markdown 列表并追加到 `hourly_draft.md` 草稿箱中。**此过程零 LLM 消耗，极度稳定。**

#### 二、 浓缩器：每日记忆蒸馏与遗忘 (`daily_routine.py`)

* **夜间批处理:** 每日凌晨（如 4:00）触发。
* **LLM 蒸馏:** 读取积攒一天的草稿箱，交给大模型提取事实与偏好（更新 `MEMORY.md`）并生成第一人称的昨日总结（生成 `YYYY-MM-DD.md` 日记）。
* **物理遗忘 (退出机制):** 任务完成后，**强行清空** `hourly_draft.md`，从物理文件层面消除记忆负担，防止上下文爆栈。

#### 三、 社交引擎：懂进退的主动搭话 (`random_chat.py`)

* **静默网关:** 每小时进行环境嗅探。通过“时间锁（深夜勿扰）”、“冷却锁（4小时防轰炸）”和“概率锁（30%随机性）”拦截大部分触发。
* **LLM 决策与 SKIP (退出机制):** 读取 `MEMORY.md` 的长期画像。如果大模型判定当前缺乏有趣的新鲜话题，强制输出 `SKIP` 直接中断流程，做到“无话可说时绝不尬聊”。
* **滑动窗口防重:** 维护一个包含近 5 次话题标签的 JSON 队列，并在 Prompt 中要求 LLM 避开这些话题，彻底根除“老年痴呆式”重复问候。
